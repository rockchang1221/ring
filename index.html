<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Protocol: Hidden Star</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    
    <!-- è¨­å®š Icon (é¸ç”¨) -->
    <link rel="icon" href="favicon/favicon-64.ico">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'void-bg': '#0f1020',      
                        'rose-gold': '#F4C4C4',    
                        'star-pink': '#FF7EB3',    
                        'tech-cyan': '#7AF8FF',    
                        'soft-text': '#F3E8FF',    
                    },
                    fontFamily: {
                        sans: ['"Noto Sans TC"', 'sans-serif'],
                        mono: ['"Space Mono"', 'monospace'],
                    },
                    boxShadow: {
                        'glow-pink': '0 0 15px rgba(255, 126, 179, 0.4), 0 0 30px rgba(255, 126, 179, 0.2)',
                        'glow-cyan': '0 0 15px rgba(122, 248, 255, 0.4)',
                        'input-focus': '0 0 20px rgba(122, 248, 255, 0.3), inset 0 0 10px rgba(122, 248, 255, 0.1)',
                    },
                    backgroundImage: {
                        'gradient-magic': 'linear-gradient(135deg, #7AF8FF 0%, #FF7EB3 100%)',
                    },
                    animation: {
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'slide-up': 'slideUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'twinkle': 'twinkle 3s ease-in-out infinite',
                        'shake': 'shake 0.5s cubic-bezier(.36,.07,.19,.97) both',
                    },
                    keyframes: {
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(30px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        twinkle: {
                            '0%, 100%': { opacity: '0.3', transform: 'scale(1)' },
                            '50%': { opacity: '1', transform: 'scale(1.2)' },
                        },
                        shake: {
                            '10%, 90%': { transform: 'translate3d(-1px, 0, 0)' },
                            '20%, 80%': { transform: 'translate3d(2px, 0, 0)' },
                            '30%, 50%, 70%': { transform: 'translate3d(-4px, 0, 0)' },
                            '40%, 60%': { transform: 'translate3d(4px, 0, 0)' }
                        }
                    }
                }
            }
        }
    </script>
    
    <style>
        body {
            background-color: #0f1020;
            color: #F3E8FF;
            background-image: 
                radial-gradient(circle at 50% 10%, rgba(122, 248, 255, 0.08), transparent 40%),
                radial-gradient(circle at 50% 90%, rgba(255, 126, 179, 0.08), transparent 40%);
            overflow: hidden;
        }

        /* ç»ç’ƒé¢æ¿ */
        .magic-card {
            background: rgba(20, 20, 40, 0.7);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        /* é­”æ³•è¼¸å…¥æ¡† */
        .magic-input {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(122, 248, 255, 0.3);
            color: #7AF8FF;
            font-family: 'Space Mono', monospace;
            letter-spacing: 0.1em;
            transition: all 0.3s ease;
        }
        .magic-input:focus {
            outline: none;
            border-color: #7AF8FF;
            box-shadow: 0 0 20px rgba(122, 248, 255, 0.3), inset 0 0 10px rgba(122, 248, 255, 0.1);
            background: rgba(0, 0, 0, 0.5);
        }
        .magic-input::placeholder {
            color: rgba(122, 248, 255, 0.3);
        }

        /* é­”æ³•æŒ‰éˆ• */
        .btn-magic-primary {
            background: linear-gradient(135deg, rgba(122, 248, 255, 0.2) 0%, rgba(255, 126, 179, 0.2) 100%);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            font-family: 'Space Mono', monospace;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
            transition: all 0.3s ease;
        }
        .btn-magic-primary:hover {
            border-color: #F4C4C4;
            box-shadow: 0 0 20px rgba(255, 126, 179, 0.6);
            background: linear-gradient(135deg, rgba(122, 248, 255, 0.4) 0%, rgba(255, 126, 179, 0.4) 100%);
            transform: translateY(-1px);
        }

        /* ç…™ç«æ–‡å­— */
        .fireText {
            position: absolute;
            color: #fff;
            font-size: 1.1rem;
            pointer-events: none;
            white-space: nowrap;
            text-shadow: 0 0 8px rgba(255, 126, 179, 0.8), 0 0 15px rgba(122, 248, 255, 0.6);
            animation: fadeUp 1.8s forwards;
            font-family: "Noto Sans TC", sans-serif;
            font-weight: 500;
            z-index: 50;
            transform: translateX(-50%);
            letter-spacing: 0.05em;
        }

        @keyframes fadeUp {
            0% {opacity:0; transform: translate(-50%, 10px);}
            20% {opacity:1; transform: translate(-50%,0);}
            100% {opacity:0; transform: translate(-50%,-80px);}
        }

        #fireworkCanvas {
            position: fixed;
            top: 0; left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: auto;
        }

        /* æ˜Ÿå…‰ç²’å­ */
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 4s infinite;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center selection:bg-star-pink selection:text-white">

    <!-- èƒŒæ™¯æ˜Ÿå¡µ -->
    <div class="fixed inset-0 pointer-events-none z-0">
        <div class="star w-0.5 h-0.5 top-[10%] left-[20%] opacity-40"></div>
        <div class="star w-1 h-1 top-[30%] left-[80%] opacity-60" style="animation-delay: 1.2s;"></div>
        <div class="star w-0.5 h-0.5 top-[70%] left-[15%] opacity-30" style="animation-delay: 2.5s;"></div>
        <div class="star w-1 h-1 top-[85%] left-[70%] opacity-50" style="animation-delay: 0.5s;"></div>
        <div class="star w-0.5 h-0.5 top-[50%] left-[50%] opacity-40" style="animation-delay: 3s;"></div>
    </div>

    <!-- é ‚éƒ¨ç‹€æ…‹åˆ— -->
    <div class="fixed top-0 left-0 w-full flex justify-between items-center p-6 z-50 pointer-events-none">
        <span class="text-[10px] font-mono tracking-widest text-rose-gold/80">PROTOCOL: HIDDEN_STAR</span>
        <div class="flex items-center gap-2">
            <span class="w-1.5 h-1.5 rounded-full bg-star-pink animate-pulse"></span>
            <span class="text-[10px] font-mono font-bold text-star-pink tracking-wider">LOCKED</span>
        </div>
    </div>

    <!-- ====== ç™»å…¥å€ ====== -->
    <section id="loginSection" class="relative z-10 w-full max-w-sm px-6 animate-slide-up">
        
        <div class="magic-card p-8 flex flex-col items-center text-center">
            
            <!-- è£é£¾Icon -->
            <div class="mb-6 relative">
                <div class="absolute inset-0 bg-gradient-magic blur-xl opacity-30 rounded-full animate-pulse-slow"></div>
                <div class="w-16 h-16 rounded-full border border-rose-gold/30 flex items-center justify-center relative z-10 bg-void-bg/50 backdrop-blur-sm">
                    <svg class="w-8 h-8 text-rose-gold" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                    </svg>
                </div>
            </div>

            <h2 class="text-2xl font-bold text-white tracking-wide mb-2 font-sans">
                è§£é–æ˜Ÿå…‰è¨˜æ†¶
            </h2>
            <p class="text-sm text-soft-text/60 mb-6 font-light">
                Unlock the Starlight Memory
            </p>

            <!-- é¡Œç›®é¡¯ç¤ºå€ -->
            <div class="w-full mb-6">
                <div id="question" class="text-sm font-mono text-tech-cyan tracking-wider border-b border-tech-cyan/20 pb-2">
                    <!-- JS æœƒå¡«å…¥é¡Œç›® -->
                </div>
            </div>

            <!-- è¼¸å…¥å€ -->
            <div class="w-full space-y-4">
                <input type="text" id="codeInput" placeholder="PASSCODE" 
                       class="w-full magic-input rounded-xl px-4 py-3 text-center text-lg uppercase">
                
                <button id="submitBtn" 
                        class="w-full btn-magic-primary rounded-xl py-3 text-sm font-bold tracking-widest uppercase">
                    è§£é–
                </button>
            </div>
            
        </div>
    </section>

    <!-- ====== ç…™ç«å€ ====== -->
    <section id="fireworkSection" style="display: none;">
        <canvas id="fireworkCanvas"></canvas>
        
        <!-- æç¤ºè¨Šæ¯ -->
        <div id="fireworkMessage" class="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-10 w-full text-center pointer-events-none transition-opacity duration-1000">
            <div class="inline-block px-6 py-2 rounded-full border border-tech-cyan/30 bg-void-bg/40 backdrop-blur-md text-tech-cyan text-xs font-mono tracking-widest animate-pulse-slow">
                é»çœ‹çœ‹è¢å¹•æœƒå‡ºç¾ä»€éº¼ğŸ‘€<br>ç”¨é›»è…¦çœ‹æ›´å£¯è§€ğŸ¤«
            </div>
        </div>
    </section>

    <!-- éŸ³æ•ˆ (è«‹ç¢ºä¿æª”æ¡ˆå­˜åœ¨) -->
    <audio id="fireworkMusic" src="äººé–“ç…™ç«.MP3" loop></audio>
    <audio id="fireworkSound" src="firework_boom.MP3"></audio>
    <audio id="singleFireSound" src="single_fire.MP3"></audio>

    <script>
        // ====== é¡Œåº« (ä¿æŒåŸé‚è¼¯) ======
        const questionBank = {
            "RR-00019": "C", "RR-00020": "C", "RR-00021": "C", "RR-00022": "C",
            "RR-00023": "C", "RR-00024": "C", "RR-00025": "C", "RR-00026": "C",
            "RR-00027": "C", "RR-00028": "C", "RR-00029": "C", "RR-00030": "C",
            "RR-00031": "C", "RR-00032": "C", "RR-00033": "C", "RR-00034": "C",
            "RR-00035": "C", "RR-00036": "C", "RR-00037": "C", "RR-00038": "C",
            "RR-00039": "C", "RR-00040": "C", "RR-00041": "C", "RR-00042": "C",
            "RR-00043": "C", "RR-00044": "C", "RR-00045": "C"
        };

        // éš¨æ©ŸæŠ½é¡Œ
        const questionKeys = Object.keys(questionBank);
        const randomKey = questionKeys[Math.floor(Math.random() * questionKeys.length)];
        const correctAnswer = questionBank[randomKey];

        // é¡¯ç¤ºé¡Œç›®
        document.getElementById("question").innerHTML = `è«‹å• <span class="text-white font-bold">${randomKey}</span> çš„ç­”æ¡ˆæ˜¯ï¼Ÿ`;

        // ====== å¯†ç¢¼æª¢æŸ¥ ======
        function checkPassword() {
            const input = document.getElementById('codeInput');
            const code = input.value.trim();
            
            if(code.toUpperCase() === correctAnswer.toUpperCase()){ 
                // Unlock Animation
                const card = document.querySelector('.magic-card');
                card.style.transform = 'scale(0.95)';
                card.style.opacity = '0';
                card.style.transition = 'all 0.5s ease';
                
                setTimeout(() => {
                    document.getElementById('loginSection').style.display = "none";
                    document.getElementById('fireworkSection').style.display = "block";
                    
                    // Update Status Bar
                    const statusDot = document.querySelector('.rounded-full.bg-star-pink');
                    const statusText = document.querySelector('.text-star-pink');
                    if(statusDot && statusText) {
                        statusDot.classList.replace('bg-star-pink', 'bg-tech-cyan');
                        statusText.classList.replace('text-star-pink', 'text-tech-cyan');
                        statusText.innerText = 'UNLOCKED';
                    }

                    startFireworks();
                    enableSparkMode();
                }, 500);

            } else {
                // Shake Effect
                const card = document.querySelector('.magic-card');
                card.classList.remove('animate-shake');
                void card.offsetWidth; // Trigger reflow
                card.classList.add('animate-shake');
                
                input.value = '';
                input.classList.add('border-red-400', 'text-red-400');
                input.placeholder = "ACCESS DENIED";
                
                setTimeout(() => {
                    input.classList.remove('border-red-400', 'text-red-400');
                    input.placeholder = "PASSCODE";
                }, 1000);
            }
        }
        
        document.getElementById('submitBtn').addEventListener('click', checkPassword);
        document.getElementById('codeInput').addEventListener('keydown', (e) => {
            if (e.key === 'Enter') checkPassword();
        });

        // ====== ç…™ç«è¨­å®š (Star Guardian Colors) ======
        const canvas = document.getElementById('fireworkCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let particles = [];
        // [æ˜Ÿå…‰æµ·å…‹æ–¯é…è‰²]ï¼šç«ç‘°é‡‘ã€æ˜Ÿå…‰ç²‰ã€ç§‘æŠ€é’ã€ç´”ç™½ã€æ·ºç´«
        let colors = ["#F4C4C4", "#FF7EB3", "#7AF8FF", "#FFFFFF", "#E0B0FF"]; 
        let autoFireworkStarted = false;
        let musicStarted = false;
        let firstClick = true;
        let sparkMode = false;

        function createFirework(x, y, withText=false) {
            for(let i=0;i<50;i++){ // å¢åŠ ç²’å­æ•¸é‡
                const speed = Math.random()*5 + 2;
                const angle = Math.random()*Math.PI*2;
                particles.push({
                    x: x, y: y,
                    vx: Math.cos(angle)*speed,
                    vy: Math.sin(angle)*speed,
                    alpha: 1,
                    size: Math.random() * 2 + 1, // ç²’å­å¤§å°éš¨æ©Ÿ
                    color: colors[Math.floor(Math.random()*colors.length)],
                    decay: Math.random() * 0.015 + 0.01 // éš¨æ©Ÿæ¶ˆæ•£é€Ÿåº¦
                });
            }
            if(withText){
                showFireText(x, y);
                if(!musicStarted){
                    musicStarted = true;
                    document.getElementById('fireworkMusic').play().catch(()=>{});
                }
            }
        }

        function createSpark(x, y){
            for(let i=0;i<8;i++){
                const speed = Math.random()*1.0 + 0.2;
                const angle = Math.random()*Math.PI*2;
                particles.push({
                    x: x, y: y,
                    vx: Math.cos(angle)*speed,
                    vy: Math.sin(angle)*speed,
                    alpha: 0.8,
                    size: 1,
                    color: Math.random() < 0.5 ? "#7AF8FF" : "#FF7EB3", // é’ç²‰ç«èŠ±
                    decay: 0.05
                });
            }
        }

        const myWords = ["",""]; 
        const herWords = ["",""]; 

        function showFireText(x, y){
            const text = document.createElement("div");
            text.className = "fireText";
            text.style.left = x + "px"; 
            text.style.top = y + "px";
            if(x < canvas.width/2){
                text.textContent = myWords[Math.floor(Math.random()*myWords.length)];
            } else {
                text.textContent = herWords[Math.floor(Math.random()*herWords.length)];
            }
            document.body.appendChild(text);
            setTimeout(()=>{ text.remove(); },1800);
        }

        function animate() {
            // ä½¿ç”¨å¸¶æœ‰ç´«è‰²çš„é»‘è‰²æ‹–å°¾ï¼Œå¢åŠ å¤¢å¹»æ„Ÿ
            ctx.fillStyle = "rgba(15, 16, 32, 0.25)"; 
            ctx.fillRect(0,0,canvas.width,canvas.height);
            
            for(let i=0;i<particles.length;i++){
                const p = particles[i];
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);
                ctx.fillStyle = p.color;
                ctx.globalAlpha = p.alpha;
                // åŠ å…¥ç™¼å…‰æ•ˆæœ
                ctx.shadowBlur = 10;
                ctx.shadowColor = p.color;
                ctx.fill();
                // é‡ç½® shadow ä»¥å…å½±éŸ¿æ•ˆèƒ½
                ctx.shadowBlur = 0; 

                p.x += p.vx;
                p.y += p.vy;
                p.alpha -= p.decay;
                if(p.alpha <= 0) particles.splice(i,1);
            }
            ctx.globalAlpha = 1;
            requestAnimationFrame(animate);
        }
        function startFireworks(){ animate(); }

        canvas.addEventListener('click', (e)=>{
            const singleBoom = document.getElementById('singleFireSound');
            singleBoom.currentTime = 0;
            singleBoom.play().catch(()=>{}); 
            
            createFirework(e.clientX, e.clientY, true);

            if(firstClick){
                firstClick = false;
                const boom = document.getElementById('fireworkSound');
                boom.currentTime = 0;
                boom.play().catch(()=>{});
                
                // é–‹å ´é€£ç™¼
                for(let i=0; i<30; i++){
                    setTimeout(()=>{
                        createFirework(
                            Math.random()*canvas.width,
                            Math.random()*canvas.height/2 + canvas.height/4
                        );
                    }, i*50);
                }
            }

            if(!autoFireworkStarted){
                autoFireworkStarted = true;
                // æ·¡å‡ºæç¤ºæ–‡å­—
                document.getElementById("fireworkMessage").style.opacity = '0';
                setInterval(()=>{
                    createFirework(Math.random()*canvas.width, Math.random()*canvas.height/2 + canvas.height/4);
                },600);
            }
        });

        // ====== æ»‘é¼ å¼•ç·šç«èŠ± ======
        let mouseX = null, mouseY = null;
        function enableSparkMode(){
            sparkMode = true;
        }
        document.addEventListener('mousemove',(e)=>{
            if(sparkMode && window.innerWidth > 768){
                mouseX = e.clientX;
                mouseY = e.clientY;
            }
        });
        setInterval(()=>{
            if(sparkMode && mouseX!==null && window.innerWidth > 768){
                createSpark(mouseX, mouseY);
            }
        },30);

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });
    </script>
</body>
</html>
